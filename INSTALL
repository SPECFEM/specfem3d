
!=======================================================================!
!                                                                       !
!   specfem3D is a 3-D spectral-element solver for the Earth.           !
!   It uses a mesh generated by program meshfem3D                       !
!                                                                       !
!=======================================================================!

Instructions on how to install and use SPECFEM3D are
available in the manual located in directory USER_MANUAL.

Main developers: Dimitri Komatitsch and Jeroen Tromp

Additional contributions by:

Qinya Liu
Min Chen



Basic installation
------------------

1. untar the SPECFEM3D_SESAME package: 

   > tar -zxvf SPECFEM3D_SESAME*.tar.gz 

   in the following, we will assume you set the root directory of the 
   package name to:
   
   SPECFEM3D_SESAME/
   
2. configure the software for your system:

    > cd SPECFEM3D_SESAME/
    > ./configure

    by default, it uses gfortran as a Fortran compiler, mpif90 for MPI compilation
    and gcc as a C compiler. 
    
    in order to use a different compiler, use for example:
    
        > ./configure FC=ifort
  
    in this case, it would make use of
    
    - ifort, Intel Fortran Compiler 
      (see http://software.intel.com/en-us/intel-compilers/ )
      with which we see very good performance results.   
        
    - a default MPI installation which provides mpif90 as fortran wrapper command.     
      An excellent package is provided by Open MPI (see http://www.open-mpi.org/).
      
      for the example above, you would make sure that the mpif90 command 
      would also use ifort as a Fortran compiler.
    
    - a C compiler provided from the GNU compiler collection (see http://gcc.gnu.org/).
    
    in case `configure` was successful, it will create the files:

    ./Makefile
    ./constants.h
    ./precision.h
    ./DATA/Par_file
    ./DATA/CMTSOLUTION
    ./DATA/STATIONS
    
    please make sure, your installation is working and that 
    the created files 'constant.h' and 'Makefile' satisfy
    your needs. 

    more information is given in the manual provided in USERS_MANUAL.

3. compile the package:

   for the complete compilation of the package, you must provide: 
   ./DATA/Par_file 
   ./DATA/CMTSOLUTION 
   ./DATA/STATIONS

   default simulation files are provided in the directory DATA/ which you can
   use as the ones needed above.

   then type

   > make
   
   
well done!




Configure options
-----------------

'configure' accepts the following options:

FC                          Fortran90 compiler command name, 
                            default is 'gfortran'
 
MPIFC                       MPI Fortran90 command name, 
                            default is 'mpif90'

CC                          C compiler command name,
                            default is 'gcc'

FLAGS_CHECK                 Compiler ﬂags for non-critical subroutines, 
                            default is '-O3'
                  
FLAGS_NO_CHECK              Compiler ﬂags for creating fast, production-run code for 
                            critical subroutines,
                            default is '-O3'

LOCAL_PATH_IS_ALSO_GLOBAL   Directory LOCAL_PATH (specified in DATA/Par_file) on the
                            cluster can be accessed by all compute nodes ('true') or not ('false'),
                            default is 'true'


and flags:


--enable-double-precision   The package can run either in single or in double precision.
                            default is single precision 
                            
--help                      Directs configure to print a usage screen 
                            

run with 
  ./configure <option>=<my_option> --<flag>
  

Compiler specific flags are set in file 'flags.guess' in order to provide
suitable default options for different compilers. 

you might however want to modify the created 'Makefile' and specify your best 
system compiler flags in order to ensure optimal performance of the code. 





Troobleshooting
---------------

FAQ

1. configuration fails:

   Examine the log file 'config.log'. It contains detailed informations.
   in many cases, the path's to these specific compiler commands F90, 
   CC and MPIF90 won't be correct if `configure` fails.
   
   please make sure that you have a working installation of a Fortran compiler, 
   a C compiler and an MPI implementation. you should be able to compile this
   little program code:
   
      program main
        include 'mpif.h'
        integer, parameter :: CUSTOM_MPI_TYPE = MPI_REAL
        integer ier
        call MPI_INIT(ier)
        call MPI_BARRIER(MPI_COMM_WORLD,ier)
        call MPI_FINALIZE(ier)
      end

    
2. compilation fails stating :
    ... 
    obj/program_generate_databases.o: In function `MAIN__':
    program_generate_databases.f90:(.text+0x14): undefined reference to `_gfortran_set_std'    
    ...
    
  make sure, you're pointing to the right 'mpif90' wrapper command. 
  
  normally, this message will appear when you're mixing two different fortran
  compilers. that is, using e.g. gfortran to compile non-MPI files 
  and mpif90, wrapper provided for e.g. ifort, to compile MPI-files. 
  
  fix: e.g. specify > ./configure FC=gfortran MPIF90=/usr/local/openmpi-gfortran/bin/mpif90
  
  
       
