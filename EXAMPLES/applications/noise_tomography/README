----------------------------------------------------------------------
README
----------------------------------------------------------------------

////////////////////////////////WARNING///////////////////////////////////////////
Do ***NOT*** try this example until you have become familiar with other examples
Also, make sure that you understand the theory in:
Noise Cross-Correlation Sensitivity Kernels (Tromp et al., 2010, GJI)
////////////////////////////////WARNING///////////////////////////////////////////


**************
0. README
**************

   This example shows how one can construct noise cross-correlation sensitivity kernels.
   Note that this example uses a relatively low resolution, and is only presented for illustrational purpose.

**************
1. Structure
**************

   This file                                                  ---  README
   Folders containing default input files for the example     ---  ./DATA       ./NOISE_TOMOGRAPHY
   Two matlab files may help you to calculate noise spectrum  ---  NOISE_TOMOGRAPHY.m     PetersonNoiseModel.m
   Job script                                                 ---  run_this_example.sh
   One folder shows the reference kernels                     ---  ./REF_KERNELS

**************
2. Usage
**************

   If you have at least 4 cores and mpif90 works on your workstation, you can run this example on your workstation. Simply use:
   (after configuration, for example, "./configure FC=ifort MPIFC=mpif90". Should you be confused, familiarize yourself with other examples first)
   ./run_this_example.sh

   If you don't, you have to follow commands listed in ./run_this_example.sh, make modifications if needed.
   Those commands in ./run_this_example.sh should be self-explanatory.
   You may want to compare them with descriptions in the Manual --- ../../../doc/USER_MANUAL/manual_SPECFEM3D.pdf

**************
3. Details
**************

   3.0 - As mentioned before, you can always refer to "Noise Cross-Correlation Sensitivity Kernels (Tromp et al., 2010, GJI)" for theoretical perspective,
         and the Manual --- "../../../doc/USER_MANUAL/manual_SPECFEM3D.pdf" for technical issues.

   3.1 - Model
         This example uses the same model as in 'EXAMPLES/applications/homogeneous_halfspace/'
         In other words, the dimension of the model is 134 km * 134 km * 60 km, with Vp=2.8km/s, Vs=1.5km/s

   3.2 - Source and Receivers
         Since NO earthquakes are allowed for noise simulations, we have a ZERO moment tensor in "./DATA/CMTSOLUTION"
         As for receivers, instead of having a lot of stations in 'EXAMPLES/applications/homogeneous_halfspace',
         we have only two receivers in "./DATA/STATIONS" and "./DATA/STATIONS_ADJOINT"

   3.3 - Noise statistics
         "./NOISE_TOMOGRAPHY" contains:
         S_squared --- the ensemble-averaged noise power spectrum.
                       it can be generated by calling in MATLAB:
                          > NOISE_TOMOGRAPHY(999,0.12,10.,20.,'FLAT')
                       (using a flat noise spectrum, refer to "./NOISE_TOMOGRAPHY.m" for details about the MATLAB scripts)
         nu_main   --- the component of seismogram at the 'main' receiver, which is used to calculate cross correlations
                       (the components at 'secondary' receivers are components of the simulated seismograms obtained in step 2 of noise simulations)
         irec_main_noise_contribution1, irec_main_noise_contribution2
                   --- main receiver ID

         Other statistics, such as noise direction & noise distribution, are described in "src/specfem3d/noise_tomography.f90"
         The default assumes vertical noises and a uniform distribution.
         You may modify subroutine "noise_distribution_direction" in "src/specfem3d/noise_tomography.f90" for your own purpose

   3.4 - Utils
         "adj_traveltime_filter.f90" is used to calculate adjoint sources (only works for default set-up)

**************
4. Results
**************

   At the end of those simulations, kernel files will be saved in OUTPUT_FILES/contribution_1/ & OUTPUT_FILES/contribution_2/ directory:
    1st_beta_kernel.vtk --- first contribution kernel
    2nd_beta_kernel.vtk --- second contribution kernel

   These can be directly viewed in Paraview. Once you visualize them in Paraview, you should see pictures similar to those in REF_KERNELS/

