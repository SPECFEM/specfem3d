----------------------------------------------------------------------
README
----------------------------------------------------------------------

step-by-step tutorial:

1. configure package:
   
   - From the SPECFEM3D_SESAME root directory /SPECFEM3D_SESAME/
     configure the package, e.g. using intel's ifort compiler:
     > cd /SPECFEM3D_SESAME
     > ./configure F90=ifort  

     If successful, this will generate the files:
     Makefile, constants.h, and precision.h, among others

   - make a directory for the databases
     > mkdir DATABASES_MPI
 

2. create mesh:

   - change to the examples directory /SPECFEM3D_SESAME/EXAMPLES/homogeneous_halfspace:
     > cd EXAMPLES/homogeneous_halfspace

   - open the cubit GUI:
     > claro (or cubit)
     
     then run meshing script: 
     claro -> Menu "Tools" -> "Play Journal File" ... and select file: "block_mesh.py"
    
     if everything goes fine, this creates all the mesh files in a subdirectory MESH/:     
        MESH/absorbing_surface_file_bottom
        MESH/absorbing_surface_file_xmax
        MESH/absorbing_surface_file_xmin
        MESH/absorbing_surface_file_ymax
        MESH/absorbing_surface_file_ymin
        MESH/free_surface_file
        MESH/materials_file
        MESH/mesh_file
        MESH/nodes_coords_file
        MESH/nummaterial_velocity_file
     

3. decompose mesh files:

   - run decomposer in directory /SPECFEM3D_SESAME/decompose_mesh_SCOTCH/:
     (example assumes 4 partitions with mesh files in ../EXAMPLES/homogeneous_halfspace/MESH/)
     > cd /SPECFEM3D_SESAME/decompose_mesh_SCOTCH
     > make

     NOTE 1: check that the two scotch libraries are properly specified in Makefile
     NOTE 2: compile with the same compiler (ifort or gfortran) used
              for the SCOTCH libraries

     > ./xdecompose_mesh_SCOTCH 4 ../EXAMPLES/homogeneous_halfspace/MESH/ ../DATABASES_MPI/ 
            
     which creates mesh partitions "proc0000***_Database" in directory DATABASES_MPI/.
     (you can then specify "DATABASES_MPI" in "Par_file" for your "LOCAL_PATH")


4. generate databases:

   - copy three files -- Par_file, CMTSOLUTION, STATIONS -- from
      /SPECFEM3D_SESAME/EXAMPLES/homogeneous_halfspace/ to /SPECFEM3D_SESAME/DATA/

   - compile generate_databases from /SPECFEM3D_SESAME/ :    
     > cd /SPECFEM3D_SESAME
     > make xgenerate_databases
     
   - submit job script
     > qsub go_generate_database_pbs.sesame.bash

     NOTE: this script will need to be tailored to your cluster, e.g.,
     > bsub < go_generate_database_lsf.sesame.bash

     this will create binary mesh files, e.g. "proc000***_external_mesh.bin" 
     in directory DATABASES_MPI/.


5. run simulation:

   - compile specfem3D:
     > make xspecfem3D
      
   - submit job script:
     > qsub go_solver_pbs.sesame.bash

     NOTE 1: this script will need to be tailored to your cluster
     NOTE 2: the simulation runs on 4 cores and should take about 15 minutes,
             and you can track the progress with the timestamp files
     NOTE 3: you should have 672 x 3 (semd,semv,sema) seismograms in OUTPUT_FILES


6. check with 6 reference seismograms in 
      /SPECFEM3D_SESAME/EXAMPLES/homogeneous_halfspace/REF_SEIS/    

   - execute gnuplot script
     > cd /SPECFEM3D_SESAME/EXAMPLES/homogeneous_halfspace/REF_SEIS 
     > gnuplot

         gnuplot> load "X1-50.BHZ.gnuplot"

     You should see a figure in a render window.
     Writing the figure to a file may depend on your gnuplot settings.
     One example to generate a postscript is shown below:

         gnuplot> load "X1-50.BHZ.gnuplot"
         gnuplot> set term postscript color solid
         Terminal type set to 'postscript'
         Options are 'landscape noenhanced color colortext \
            solid dashlength 1.0 linewidth 1.0 defaultplex \
            palfuncparam 2000,0.003 \
            butt "Helvetica" 14'
         gnuplot> set output 'my.ps'
         gnuplot> replot
         gnuplot> quit


7. plot your output seismograms in /SPECFEM3D_SESAME/OUTPUT_FILES/

   - copy gnuplot script X1-50.BHZ.gnuplot to local directory:
     > cp /SPECFEM3D_SESAME/EXAMPLES/homogeneous_halfspace/REF_SEIS/X1-50.BHZ.gnuplot /SPECFEM3D_SESAME/OUTPUT_FILES

   - execute same commands as above

   - you should see the same image as generated from the reference seismograms,
      but the record length is 25 s (instead of 42 s)

===========================================================

